## Separata Detallada: Creación de Bases de Datos y Esquemas en PostgreSQL

### V. Creación de Bases de Datos y Esquemas

Esta sección aborda la gestión de bases de datos y la estructuración interna mediante esquemas, incluyendo las prácticas recomendadas para la eliminación y creación.

#### A. Creación y Eliminación de Bases de Datos

La creación de una base de datos de ejemplo fue demostrada, inicialmente utilizando el nombre `tienda DBA`. Posteriormente, la base de datos se nombró `tienda DB`.

**Manejo de Conexiones Activas para Eliminación (DROP DATABASE):**

Para eliminar una base de datos mediante la sentencia `DROP DATABASE tienda DBA`, puede surgir un problema si la base de datos se encuentra **activa** o está siendo utilizada,. La base de datos puede estar activa si ha sido seleccionada con doble clic.

Para proceder con la eliminación de la base de datos de forma profesional, es necesario **terminar todas las conexiones existentes**,. Esto se logra mediante una consulta a la vista del sistema **`PG_STAT_ACTIVITY`**. El comando `TERMINATE` se utiliza para finalizar el *backend* que se encuentra activo, permitiendo la correcta ejecución del `DROP DATABASE`.

**Creación Correcta de Bases de Datos:**

Para crear la base de datos de forma correcta, se utiliza la sentencia `CREATE DATABASE` junto con parámetros específicos mediante la cláusula `WITH`:

1.  **Propietario (`OWNER`):** Se especifica el usuario que será el dueño de la base de datos (por ejemplo, el usuario por defecto `postgres`).
2.  **Codificación (`ENCODING`):** Se establece el tipo de codificación, siendo **`UTF8`** el estándar más utilizado.
3.  **Límites de Conexión (`CONNECTION LIMIT`):** Se puede definir el máximo de conexiones permitidas, donde `-1` (o un valor mayor a uno) es necesario.
4.  **Plantilla (`TEMPLATE 0`):** Se recomienda usar la plantilla **`TEMPLATE 0`**. Esta plantilla es la que se define para que el usuario la utilice para crear sus propias bases de datos, a diferencia de `template 1` que es la plantilla de datos del sistema,.

#### B. Definición de Esquemas

Después de crear una base de datos, como `tienda DB`, esta contendrá un esquema por defecto llamado `public`. Es una buena práctica crear un esquema propio para evitar el uso del esquema público.

**Conexión a la Base de Datos Creada:**

Antes de crear el esquema, es necesario **conectarse a la base de datos** recién creada. En la interfaz de PGAdmin, esto se realiza creando una nueva conexión y seleccionando la base de datos (`tienda DB`), y utilizando un rol con suficientes permisos (como el rol `postgres`, el super administrador).

**Creación del Esquema:**

El esquema propio se crea utilizando la sentencia:
`CREATE SCHEMA IF NOT EXISTS tienda`.

**Definición del Esquema por Defecto (Search Path):**

Si no se define el esquema por defecto, al crear tablas se tendría que prefijar el nombre de la tabla con el nombre del esquema (ejemplo: `tienda.nombre_tabla`). Para evitar esta necesidad de prefijar, se define el esquema como la ruta de búsqueda (`search_path`) por defecto. Esto se logra con el comando **`SET search_path TO tienda`**, estableciendo el esquema propio como el predeterminado para las operaciones.