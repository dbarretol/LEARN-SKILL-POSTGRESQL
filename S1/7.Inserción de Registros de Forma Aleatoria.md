## Separata: Inserción de Registros de Forma Aleatoria en PostgreSQL

Esta sección describe cómo realizar **inserciones masivas de datos de prueba** en PostgreSQL, combinando `INSERT INTO` con funciones como `generate_series`, `random`, `MD5` y expresiones `CASE`.

---

### VII. Inserción de Registros de Forma Aleatoria

El objetivo es poblar la tabla `usuario` con muchos registros de prueba de forma rápida y controlada.

#### 1. Inserción Masiva con `INSERT INTO ... SELECT`

La inserción se realiza con una sentencia del tipo:

```sql
INSERT INTO usuario (nombres, apellidos, email, password, telefono, es_admin)
SELECT
    -- columnas generadas aquí
FROM
    generate_series(1, 100) AS i;
```

- Se listan solo las columnas que **no** se generan automáticamente (por ejemplo, el `UUID` si tiene `DEFAULT uuid_generate_v4()`).
- La parte `SELECT ... FROM generate_series(...)` se encarga de producir los datos.

---

#### 2. Generación de Múltiples Registros con `generate_series`

La función:

```sql
generate_series(1, 100)
```

genera 100 filas con valores enteros del 1 al 100, que se referencian como `i`.  
Cada valor de `i` sirve para variar los datos de cada registro (nombres, correos, teléfonos, etc.).

Ejemplo de uso básico:

```sql
FROM generate_series(1, 100) AS i
```

---

#### 3. Generación de Nombres, Apellidos y Correos

Se combinan cadenas fijas con el índice `i` para crear datos diferenciados:

- **Nombres y apellidos**:  
  Se parte de una base de texto y se concatena el número de serie:

  ```sql
  'skill_nombre_'  || i AS nombres,
  'skill_apellido_' || i AS apellidos,
  ```

- **Correo electrónico**:  
  Se construye usando el nombre, el apellido y un dominio fijo:

  ```sql
  LOWER('skill' || i || '@skill.com') AS email,
  ```

(Se puede usar `LOWER` para normalizar el email en minúsculas.)

---

#### 4. Generación y Hash de Contraseñas (MD5 + RANDOM)

Para generar contraseñas de prueba:

- `random()` devuelve un número decimal entre 0 y 1.
- `MD5()` aplica un hash al valor generado.

Ejemplo:

```sql
MD5(random()::TEXT) AS password,
```

Cada fila recibirá una cadena *hasheada* distinta, adecuada como contraseña de prueba (no usar en producción para seguridad real).

---

#### 5. Datos Condicionados con `CASE WHEN` (Teléfono y es_admin)

Para crear patrones o variaciones más realistas se usa `CASE` combinado con el operador módulo (`%`):

- **Teléfono (o dirección, etc.):**

  ```sql
  CASE
      WHEN i % 3 = 0 THEN '999-111-000'
      WHEN i % 3 = 1 THEN '999-222-000'
      ELSE '999-333-000'
  END AS telefono,
  ```

- **Campo administrador (`es_admin`)**:  
  Por ejemplo, hacer administrador a 1 de cada 10 usuarios:

  ```sql
  CASE 
      WHEN i % 10 = 0 THEN TRUE
      ELSE FALSE
  END AS es_admin
  ```

---

#### 6. Ejemplo Completo de Inserción Masiva

```sql
INSERT INTO usuario (nombres, apellidos, email, password, telefono, es_admin)
SELECT
    'skill_nombre_'   || i                         AS nombres,
    'skill_apellido_' || i                         AS apellidos,
    LOWER('skill' || i || '@skill.com')           AS email,
    MD5(random()::TEXT)                           AS password,
    CASE
        WHEN i % 3 = 0 THEN '999-111-000'
        WHEN i % 3 = 1 THEN '999-222-000'
        ELSE '999-333-000'
    END                                           AS telefono,
    CASE 
        WHEN i % 10 = 0 THEN TRUE
        ELSE FALSE
    END                                           AS es_admin
FROM generate_series(1, 100) AS i;
```

---

Después de ejecutar el `INSERT`, se puede verificar la inserción mediante:

```sql
SELECT * FROM usuario;
```

Se comprobará que:

- Se han creado 100 registros.
- Los `UUID` (si están definidos con `DEFAULT uuid_generate_v4()`) se generan automáticamente.
- Las contraseñas son aleatorias y almacenadas como hashes MD5.
- Los campos como `telefono` y `es_admin` respetan los patrones definidos por las expresiones `CASE`.