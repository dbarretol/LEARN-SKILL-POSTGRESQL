## Separata: Introducción a PostgreSQL y Fundamentos de Bases de Datos

Esta separata presenta los **conceptos esenciales** para trabajar con bases de datos utilizando **PostgreSQL**, uno de los sistemas de gestión de bases de datos relacionales (SGBD) más utilizados en entornos profesionales.

---

## I. Conceptos Básicos

### 1. ¿Qué es una Base de Datos (BD)?

Una **base de datos** es un **conjunto organizado de datos** que:

- Se almacena de forma estructurada.
- Puede ser consultado, modificado y administrado.
- Está diseñado para ser utilizado por aplicaciones o usuarios.

Ejemplos de uso:

- Información de clientes, ventas, productos.
- Historial de transacciones.
- Sistemas de inventario, contabilidad, ERP, etc.

---

### 2. ¿Qué es un SGBD?

Un **Sistema de Gestión de Bases de Datos (SGBD)** es el **software** que:

- Crea, administra y protege las bases de datos.
- Controla el acceso concurrente de múltiples usuarios.
- Garantiza la integridad y consistencia de la información.

Ejemplos de SGBD:

| SGBD        | Tipo                      |
|------------|---------------------------|
| PostgreSQL | ORDBMS (Relacional de objetos) |
| SQL Server | Relacional                |
| MySQL      | Relacional                |
| Oracle DB  | Relacional/Enterprise     |

**PostgreSQL** es un SGBD relacional de objetos (ORDBMS), de código abierto, muy potente y extensible.

---

## II. Componentes Fundamentales de Bases de Datos Relacionales

Las bases de datos relacionales se basan en **tablas** y **relaciones** entre ellas.

### 1. Tabla

Una **tabla** es la estructura básica de almacenamiento:

- Se organiza en **filas (registros)** y **columnas (campos)**.
- Representa una entidad, por ejemplo: `clientes`, `productos`, `ventas`.

Ejemplo de tabla conceptual `clientes`:

| id_cliente | nombre   | apellido | email                      |
|-----------:|----------|---------|----------------------------|
| 1          | Ana      | Pérez   | ana.perez@example.com      |
| 2          | Juan     | López   | juan.lopez@example.com     |

---

### 2. Campos (Columnas)

Los **campos** son los **atributos** de una tabla.  
Cada columna tiene un **tipo de dato** que indica qué tipo de información puede almacenar:

- `VARCHAR(100)` → texto.
- `INTEGER` → número entero.
- `DATE` → fecha.
- `BOOLEAN` → verdadero/falso.

Ejemplo en SQL: definición básica de una tabla con tipos de datos:

```sql
CREATE TABLE clientes (
    id_cliente  SERIAL PRIMARY KEY,
    nombre      VARCHAR(100) NOT NULL,
    apellido    VARCHAR(100) NOT NULL,
    email       VARCHAR(200) NOT NULL UNIQUE,
    fecha_alta  DATE         NOT NULL DEFAULT CURRENT_DATE,
    activo      BOOLEAN      NOT NULL DEFAULT TRUE
);
```

---

### 3. Registros (Filas)

Cada **fila** corresponde a un **registro completo** dentro de la tabla.

Ejemplo: insertar registros en la tabla `clientes`:

```sql
INSERT INTO clientes (nombre, apellido, email)
VALUES
    ('Ana',  'Pérez', 'ana.perez@example.com'),
    ('Juan', 'López', 'juan.lopez@example.com');
```

---

### 4. Clave Primaria (Primary Key – PK)

La **clave primaria**:

- Identifica de forma **única** a cada registro.
- No permite valores repetidos.
- No debe ser `NULL`.

En el ejemplo anterior:

```sql
id_cliente SERIAL PRIMARY KEY
```

`id_cliente` es la clave primaria de la tabla `clientes`.

---

### 5. Clave Foránea (Foreign Key – FK)

La **clave foránea** establece una **relación** entre tablas, apuntando a una PK en otra tabla.  
Sirve para mantener la **integridad referencial**.

Ejemplo: tabla `ventas` que referencia a `clientes`:

```sql
CREATE TABLE ventas (
    id_venta    SERIAL PRIMARY KEY,
    fecha       DATE NOT NULL DEFAULT CURRENT_DATE,
    id_cliente  INT  NOT NULL,
    total       NUMERIC(10,2) NOT NULL,

    CONSTRAINT fk_ventas_clientes
        FOREIGN KEY (id_cliente)
        REFERENCES clientes (id_cliente)
);
```

- `id_cliente` en `ventas` es una **FK** que apunta a `clientes.id_cliente`.

---

### 6. Consultas (Queries) Básicas

Las **consultas SQL** permiten interactuar con la base de datos.

Operaciones más comunes (CRUD):

- `SELECT` → leer datos.
- `INSERT` → insertar nuevos registros.
- `UPDATE` → modificar registros existentes.
- `DELETE` → eliminar registros.

Ejemplos:

```sql
-- SELECT: obtener todos los clientes activos
SELECT id_cliente, nombre, apellido, email
FROM clientes
WHERE activo = TRUE;

-- UPDATE: desactivar un cliente
UPDATE clientes
SET activo = FALSE
WHERE id_cliente = 2;

-- DELETE: eliminar una venta
DELETE FROM ventas
WHERE id_venta = 10;
```

---

## III. Lenguajes Utilizados en PostgreSQL

### 1. SQL (*Structured Query Language*)

**SQL** es el lenguaje estándar para:

- Definir estructuras (`CREATE TABLE`, `ALTER TABLE`).
- Manipular datos (`SELECT`, `INSERT`, `UPDATE`, `DELETE`).
- Gestionar permisos (`GRANT`, `REVOKE`).

Ejemplo de creación y consulta:

```sql
-- Crear tabla producto
CREATE TABLE productos (
    id_producto  SERIAL PRIMARY KEY,
    nombre       VARCHAR(100) NOT NULL,
    precio       NUMERIC(10,2) NOT NULL,
    stock        INT NOT NULL DEFAULT 0
);

-- Consultar productos con stock disponible
SELECT nombre, precio, stock
FROM productos
WHERE stock > 0;
```

---

### 2. PL/pgSQL (*Procedural Language/PostgreSQL*)

**PL/pgSQL** es un lenguaje procedural que amplía SQL en PostgreSQL y permite:

- Crear **funciones** y **procedimientos almacenados**.
- Usar **variables, bucles, condiciones (`IF`, `LOOP`)**.
- Implementar **triggers** (disparadores).

Ejemplo de función simple en PL/pgSQL:

```sql
CREATE OR REPLACE FUNCTION obtener_total_ventas(p_id_cliente INT)
RETURNS NUMERIC AS
$$
DECLARE
    v_total NUMERIC(10,2);
BEGIN
    SELECT COALESCE(SUM(total), 0)
    INTO v_total
    FROM ventas
    WHERE id_cliente = p_id_cliente;

    RETURN v_total;
END;
$$ LANGUAGE plpgsql;
```

Uso:

```sql
SELECT obtener_total_ventas(1) AS total_cliente_1;
```

---

## IV. Conceptos Avanzados de Gestión de Datos

### 1. Relaciones entre Tablas

Una **relación** es el vínculo lógico entre tablas, usualmente mediante:

- Claves primarias (PK).
- Claves foráneas (FK).

Beneficios:

- Evita datos incoherentes (por ejemplo, ventas con clientes inexistentes).
- Facilita consultas que combinan varias tablas (`JOIN`).

Ejemplo de consulta con relación:

```sql
SELECT
    v.id_venta,
    v.fecha,
    c.nombre,
    c.apellido,
    v.total
FROM ventas v
JOIN clientes c ON v.id_cliente = c.id_cliente
WHERE v.fecha >= '2024-01-01';
```

---

### 2. Índices

Los **índices** son estructuras auxiliares que aceleran la búsqueda de registros.

Ventajas:

- Mejoran significativamente el rendimiento de las consultas.

Costos:

- Ocupan espacio en disco.
- Requieren mantenimiento en cada `INSERT`, `UPDATE`, `DELETE`.

Ejemplo de creación de índice:

```sql
CREATE INDEX idx_clientes_email
ON clientes (email);

CREATE INDEX idx_ventas_fecha
ON ventas (fecha);
```

---

### 3. Normalización

La **normalización** es el proceso de diseñar tablas para:

- **Reducir la redundancia** (no duplicar información innecesariamente).
- **Garantizar la integridad** de los datos.

Se basa en **formas normales** (1FN, 2FN, 3FN, etc.) que definen reglas para:

- Cómo dividir tablas.
- Qué atributos deben ir en qué tabla.

Ejemplo práctico de normalización:

- En lugar de guardar el nombre del cliente en cada venta,
- Se guarda solo el `id_cliente` y los datos del cliente viven en la tabla `clientes`.

---

### 4. Transacciones

Una **transacción** es un conjunto de operaciones que se ejecutan como una **unidad atómica**:

- O se aplican **todas**, o no se aplica **ninguna**.
- Si hay error, se puede deshacer todo con `ROLLBACK`.

Propiedades ACID (a alto nivel):

- **A**tomicidad → todo o nada.
- **C**onsistencia → la BD pasa de un estado válido a otro válido.
- **I**solamiento → transacciones no se interfieren incorrectamente entre sí.
- **D**urabilidad → una vez confirmada, la transacción persiste.

Ejemplo de transacción en PostgreSQL:

```sql
BEGIN;

UPDATE productos
SET stock = stock - 1
WHERE id_producto = 10;

INSERT INTO ventas (id_cliente, total)
VALUES (1, 100.00);

-- Si todo está bien:
COMMIT;

-- Si ocurre un error:
-- ROLLBACK;
```

---

### 5. Backups (Copias de Seguridad)

Los **backups** son copias de la base de datos (estructura y/o datos) que permiten:

- Recuperarse ante fallos, errores humanos o desastres.
- Restaurar la información a un punto anterior en el tiempo.

Formas típicas en PostgreSQL:

- Backup lógico con `pg_dump` (script SQL o formato personalizado).
- Backup físico con `pg_basebackup`.

Ejemplo básico de backup lógico:

```bash
pg_dump -U postgres -d tienda -f tienda_backup.sql
```

Y restauración:

```bash
psql -U postgres -d tienda_restaurada -f tienda_backup.sql
```

---

## Conclusión

Con estos fundamentos:

- Comprendes la **estructura básica** de una base de datos relacional.
- Sabes qué es PostgreSQL y qué lenguajes utiliza (**SQL** y **PL/pgSQL**).
- Tienes una base conceptual sobre:
  - Tablas, PK, FK, índices, relaciones.
  - Normalización, transacciones y backups.

Estos conceptos son el punto de partida para avanzar hacia temas más avanzados como:

- Optimización de consultas.
- Particionado, replicación y alta disponibilidad.
- Seguridad, roles y auditoría de datos.